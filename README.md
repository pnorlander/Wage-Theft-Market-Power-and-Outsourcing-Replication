# Replication Package: Wage Theft, Market Power, and Outsourcing

## Paper Information
- **Title**: Wage Theft, Market Power, and Outsourcing: The Case of H-1B Workers
- **Date**: December 2025
- **Authors**: Peter Norlander and Jed Devaro

See [SSRN Working Paper](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3858061) for latest version.

## Quick Start

### Step 1: Run Replication
```stata
cd "[path_to_this_directory]"
do code/00_master.do
```

This generates all tables in `output/tables/` and figures in `output/figures/`.

### Step 2: Compile PDF
```bash
pdflatex replication_paper.tex
pdflatex replication_paper.tex  # Run twice for references
```

### Step 3: View Results
Open `replication_paper.pdf` to see all replicated tables and figures.

---

## Replication Summary

### Tables Included (18 Total)

**Main Tables (6):**

| Table | Title | Output File |
|-------|-------|-------------|
| Table 1 | Descriptive Statistics (Panels A & B) | `table1.tex` |
| Table 2 | Wages, Skill Levels, Subcontractor Status | `table2.tex` |
| Table 3 | Effect on Log Violations (7 columns) | `table3.tex` |
| Table 4 | IV Regression Log Violations (8 columns) | `table4.tex` |
| Table 5 | Marginal Effects: Changes in Probability (Panels A & B) | `table5a.tex` |
| Table 6 | Marginal Effects: Probabilities at Critical Values (Panels A & B) | `table5b_panelA.tex`, `table5b_panelB.tex` |

**Appendix Tables (12):**

| Table | Title | Output File |
|-------|-------|-------------|
| Table A.1 | Negative Binomial Regressions (7 columns) | `table_a1.tex` |
| Table A.2 | Weighted Log Violations (Panels A & B) | `table_a2_panelA.tex`, `table_a2_panelB.tex` |
| Table A.3 | Weighted Log Back Wages (Panels A & B) | `table_a3_panelA.tex`, `table_a3_panelB.tex` |
| Table A.4 | Unweighted Log Back Wages (7 columns) | `table_a4.tex` |
| Table A.5 | Log Back Wages/Promised Wages (Panels A & B) | `table_a5_panelA.tex`, `table_a5_panelB.tex` |
| Table A.6 | Log BW/PW with HHI×Subcontractor (8 columns) | `table_a6.tex` |
| Table A.7 | Log Violations at Occupation-CZ-Year Level (8 columns) | `table_a7.tex` |
| Table A.8 | Log Violations at Industry-CZ-Year Level (8 columns) | `table_a8.tex` |
| Table A.9 | Unweighted Firm-Level Log Violations (Panels A & B) | `table_a9_panelA.tex`, `table_a9_panelB.tex` |
| Table A.10 | Log Violations with HHI×Subcontractor (8 columns) | `table_a10.tex` |
| Table A.11 | Unweighted Firm-Level Log Back Wages (Panels A & B) | `table_a11_panelA.tex`, `table_a11_panelB.tex` |
| Table A.12 | Log Back Wages with HHI×Subcontractor (8 columns) | `table_a12.tex` |

### Figures Included (5 of 6)

| Figure | Title | Output File | Notes |
|--------|-------|-------------|-------|
| Figure 1 | Network Graph of Silicon Valley Outsourcing | `fig1_network.pdf` | Pre-generated; source data too large |
| Figure 2a | Kernel Density of Wage Premium | `fig2a_kdensity.pdf` | |
| Figure 2b | Probability of Violation vs Wage Premium | `fig2b_prob_viol.pdf` | |
| Figure 3 | Average HHI and Count of Violations | `fig3_hhibar.pdf` | |
| Figure 4 | Violations Intensity by HHI, Subcontractor, Skill | `fig4_viol_intensity.pdf` | |
| Figure 5 | Probabilities a Firm Has a Violation | `fig5_probs.pdf` | |

### Figure Not Included

| Figure | Title | Reason |
|--------|-------|--------|
| Figure 6 | Theoretical Model Diagram | Manually created; not reproducible via code |

**Notes on Figures:**
- **Figure 1**: Pre-generated PDF included. The network graph requires 3.1 GB of source data (`h1b_2019_match_clients.dta`) which is too large for this package. Contact corresponding author for source data.
- **Figure 6**: This is a theoretical diagram created manually, not generated by Stata.

---

## Directory Structure

```
replication_package/
├── README.md                    # This file
├── PRECOMPUTED_FILES.md         # Documentation of pre-computed files
├── replication_paper.tex        # LaTeX compilation file
├── code/
│   ├── 00_master.do             # Master file - run this
│   ├── 01a_run_regressions.do   # Run all regressions (optional, slow)
│   ├── 01_tables.do             # Generate tables from .ster files
│   └── 02_figures.do            # Generate all figures
├── data/
│   └── master_db.dta            # Comprehensive analysis dataset
├── sters/
│   └── *.ster                   # Pre-saved estimation results (~115 files)
└── output/
    ├── tables/                  # Generated LaTeX tables
    │   ├── table1.tex
    │   ├── table2.tex
    │   ├── table3.tex
    │   └── ...
    └── figures/                 # Generated PDF figures
        ├── fig1_network.pdf     # Pre-generated (source data too large)
        ├── fig2a_kdensity.pdf
        ├── fig2b_prob_viol.pdf
        ├── fig3_hhibar.pdf
        ├── fig4_viol_intensity.pdf
        └── fig5_probs.pdf
```

## Replication Options

The package supports two replication modes:

### Option A: Fast Replication (Default)
Uses pre-computed `.ster` files to generate tables. Takes ~5 minutes.

```stata
cd "[path_to]/replication_package"
do code/00_master.do
```

### Option B: Full Replication
Runs all regressions from scratch, then generates tables. Takes several hours.

```stata
* In 00_master.do, change line 36 from:
local run_regressions = 0
* to:
local run_regressions = 1
```

**Warning**: The negative binomial models with firm fixed effects (Table A.1) are computationally intensive and may take hours to complete.

---

## Software Requirements

### Stata
- **Version**: Stata 16 or higher (tested on Stata 17)
- **Required Packages**:
```stata
ssc install estout
ssc install reghdfe
ssc install ppmlhdfe
ssc install nwcommands
ssc install ivreg2
ssc install xtivreg2
```

### LaTeX
- Any standard LaTeX distribution (TeXLive, MiKTeX, MacTeX)
- Required packages: booktabs, graphicx, float, hyperref, threeparttable, rotating

---

## Data Description

The `master_db.dta` file contains the comprehensive analysis dataset with all required variables. The dataset includes H-1B applications merged with wage violations data, prevailing wage data, and labor market concentration measures.

---

## Key Variables

| Variable | Description |
|----------|-------------|
| `logviol` | log(1 + 1000*(violations/H1Bs)) |
| `logbw` | log(1 + 1000*(back_wages/H1Bs)) |
| `logbwpw` | log(1 + back_wages per worker) |
| `hhithreeyearavg` | Three-year rolling HHI |
| `hhicat` | HHI category (1=Low, 2=Moderate, 3=High) |
| `subcontractor` | Binary: 1 = subcontractor firm |
| `nbr_h1bs` | Number of H-1B workers |
| `wage` | Wage offered |
| `prevailing_wage_1` | DOL prevailing wage |
| `diff_adj` | Wage premium (adjusted) |
| `wage_level` | DOL skill level (1-4) |
| `low_skill` | Binary: 1 = low skill (levels 1-2) |

---

## STER File Naming Convention

Pre-saved Stata estimation results use simplified naming. Each `.ster` file contains saved regression estimates that can be loaded with `estimates use`.

| Table | STER File Pattern | Count |
|-------|-------------------|-------|
| Table 3 | `table3_col[1-7].ster` | 7 |
| Table 4 | `table4_col[1-8].ster` | 8 |
| Table A.1 | `tablea1_col[1-7].ster` | 7 |
| Table A.2 | `tablea2a_col[1-4].ster`, `tablea2b_col[1-4].ster` | 8 |
| Table A.3 | `tablea3a_col[1-4].ster`, `tablea3b_col[1-4].ster` | 8 |
| Table A.4 | `tablea4_col[1-7].ster` | 7 |
| Table A.5 | `tablea5a_col[1-4].ster`, `tablea5b_col[1-4].ster` | 8 |
| Table A.6 | `tablea6_col[1-8].ster` | 8 |
| Table A.7 | `tablea7_col[1-8].ster` | 8 |
| Table A.8 | `tablea8_col[1-8].ster` | 8 |
| Table A.9 | `tablea9a_col[1-4].ster`, `tablea9b_col[1-4].ster` | 8 |
| Table A.10 | `tablea10_col[1-8].ster` | 8 |
| Table A.11 | `tablea11a_col[1-4].ster`, `tablea11b_col[1-4].ster` | 8 |
| Table A.12 | `tablea12_col[1-8].ster` | 8 |

**Note**: Tables 1, 2, 5, and 6 do not use .ster files (generated directly from data or marginal effects calculations).

See `PRECOMPUTED_FILES.md` for documentation of pre-computed files.

---

## Data Files Included

| File | Size | Purpose |
|------|------|---------|
| `master_db.dta` | ~307 MB | Main analysis dataset |
| `iv_data.dta` | ~2 MB | IV regression data |
| `2019_cz90_name_occ2.dta` | ~5 MB | Wage level data for Table 2 (from H-1B LCA filings) |

## External Data (Not Included)

The following data sources are required by `prepare_replication_data.do` but are not included due to size or licensing:

| File | Size | Purpose | Availability |
|------|------|---------|--------------|
| `HHIs.dta` | ~296 MB | Prevailing wage data (Figure 2) | Contact author |
| `h1b_2019_match_clients.dta` | 3.1 GB | Network graph data (Figure 1) | Contact author |

**To obtain external data**: Contact the corresponding author.

---

## Troubleshooting

### "Variable not found" errors
Run `prepare_replication_data.do` in the parent directory first to create the comprehensive dataset with all required variables.

### Figure generation fails
Ensure the data preparation step completed successfully. Check that `master_db.dta` contains variables like `diff_adj`, `low_skill`, and `hhicat`.

### LaTeX compilation errors
Ensure all required LaTeX packages are installed. Run `pdflatex` twice to resolve cross-references.

---

## Contact

For questions about this replication package, including requests for external data files (network data, prevailing wage data), please contact the corresponding author.

---

*Replication package created: February 2026*
